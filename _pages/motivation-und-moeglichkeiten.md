---
ID: 328
post_title: Motivation und Moeglichkeiten
author: rogera
post_date: 2010-09-22 18:16:49
post_excerpt: ""
layout: page
permalink: >
  http://wp.wolfspool.chickenkiller.com/wprcs1/pg-meta-pages/pg-sohorouter/motivation-und-moeglichkeiten/
published: true
sharing_disabled:
  - 'a:1:{i:0;s:1:"1";}'
---
Nach der Ubernahme eines Routers ergeben sich fuer den Angreifer eine Serie von Moeglichkeiten. Diese koennen nach ihrer Skalierbarkeit unterschieden werden, woraus sich ein modulares, mehrstufiges Angriffsszenario zusammenstellen laesst. So kann die geographische Naehe eine Rolle spielen, oder auch die Einheitlichkeit von verwertbarem Datenmaterial. Auch die noetige Vorbereitungszeit fuer einen Angriff aufgrund der Komplexitaet oder des Geheimhaltungsaspekts stellt dabei eine zu beruecksichtigende Groesse dar. Grundsaetzlich kann aber gesagt werden, dass ein verfuegbarer Router das Arsenal an Angriffsvarianten deutlich vergroessert, und die Effektivitaet von ueblicherweise bereits bestehenden und gut entwickelten Schutzsystemen und deren Infrastruktur deutlich vermindern kann. Die dezentrale Natur, die schlechte Sichtbarkeit von Effekten fuer betroffene Systeme und die eingeschraenkte Funktionalitaet beziehungsweise Bedienbarkeit von Routern spielt - einmal ueberwunden - deutlich zugunsten eines Angreifers. Aus der taktisch guenstigen Position der Mitte zwischen zwei Endpunkten koennen Datenstroeme beliebig bearbeitet werden. Aus einer Verteidigungssicht stellen beispielsweise die mangelnden diagnostischen Moeglichkeiten ein Schwierigkeit dar. Ein kontrollierter Router ist vom Angreifer je nach Risikolage seines Vorhabens in Ruhe einrichtbar, die Auswahl fuer eine Wiederherstellung reduziert sich oft auf jene zwischen einem fuer analytische Zwecke ergebnislosen Globalverlust und der Aufzeichnung von Daten, aus welchen sich nur sehr schwer Muster auslesen lassen, mittels derer auf einen Verursacher geschlossen werden koennte.
<h3>MITM-Attacken</h3>
Ein ubernommener Router ist selbstverstaendlich selbst vom MITM Typ. Bei der typischen Â verfuegbaren Rechenleistung, der general-purpose Architektur, der ausgezeichneten Netzanbindung und der robusten Arbeitsweise eroeffnen sich zahllose Verianten fuer missbraeuchliche Zwecke. In der Handhabung aehneln Router jenen beim Einsatz von virtuellen Maschinen, in ihrer Leistungsfaehigkeit erinnern die aelteren Geraete an Grossrechnersysteme der 80er Jahre. Neuere Geraete zeigen eine Performance, welche noch vor wenigen Jahren von Desktoprechnern erbracht wurde: Sie sind einerseits nicht so hoch getaktet, andererseits aber auch nicht mit den typischen aufgeblasenen Betriebssystemen belastet. Die Aktualisierung oder Aufbringung neuer Software ist unkompliziert, die Programmierung erfolgt mittlerweile weitgehend standardisiert und aus dem Bereich der Open-Source Firmwareproduktion stehen zahlreiche Halbfertigprodukte bzw. Module zur Verfuegung, welche bereits fuer die Resourceneinschraenkungen von Embedded Systems vorbereitet sind und mit verhaeltnismaessig geringem Aufwand portierbar sind. Im Vergleich zu herkoemmlicher Malware besteht klarerweise zusaetzliche Komplexitaet aufgrund der Plattformeinschraenkungen, andere Aufwaende fallen dafuer zur Zeit noch weg. So ist es derzeit noch nicht noetig, eine Modifikation der Software kunstvoll zu verstecken - auf Routern herrscht von vornherein wenig Transparenz.
<h3>Sicherung des Routers</h3>
Um eine Entdeckung der Uebernahme zu verhindern wird eine Backdoor Loesung im Authentifizierungscode des Webservers implementiert: Die von den Benutzern administrierten Kennworte waeren davon nicht betroffen, ein Zugang zum Firmware-Update von der Aussenseite kann dadurch gewaehrleistet werden. Zur Sicherung der modifizierten Firmware kann der Auto-Update Mechanismus, welcher in manchen Routermodellen vorhanden ist, zusaetzlich kurz geschlossen werden oder nur mit Kenntnis des eingebrachten Passworts durchfuehrbar sein. Diese Vorkehrungen koennen die Wiederherstellung eines Grundzustandes deutlich erschweren, weil dem typischen Anwender der Routeradministration eine voellig normale Oberflaeche praesentiert wird, und die administrativen Taetigkeiten zu keinen unerwarteten Reaktionen des Geraets fuehren.

Abgesehen von der Erweiterung des gaengigen Portfolios von Standardangriffen auf Endgeraete sind weitere eigenstaendige Szenarien moeglich.
<h4>Es bestehen zwei Moeglichkeiten zur Vorbereitung von MITM-Attacken mittels DNS:</h4>
- mittels Eintrag von kontrollierten DNS-Server Adressen in der Verwaltungsoberflaeche

- den Einbau eines fuer solche Zwecke konfektionierten DNS-Servers in der Firmware
<h3>Die Abhoerung von Daten</h3>
Mit dem Einbau eines Paketfilters in die Firmware wird der gesamte Netzwerkverkehr aus dem LAN-Segment sichtbar. Es bestuende die Moeglichkeit, nach Schluesselwoertern zu filtern, und in Intervallen oder bei Erreichen einer bestimmten Groesse ein Berichtspaket an ein Auswertungssystem zu uebertragen. Zweckmaessige Daten in diesem Zusammenhang waeren Aufrufe von E-Banking Websiten oder der Abruf von E-Mail. Aus dem gewonnenen Datenmaterial koennen E-Mail Accounts oder Kreditkarteninformation extrahiert werden, wenn der Datenverkehr nicht ueber eine gesicherte Verbindung stattgefunden hat. Ebenso koennen Anmeldenamen und Passworte von Teilnehmern gesammelt werden, welche fuer einen Angriff in die Tiefe des LAN Segments hilfreich sind. Der Umstand, dass Benutzer oft dieselben Kennungen fuer verschiedene Systeme verwenden, wuerde dabei ausgenuetzt.

In weiterer Folge eroeffnen sich Moeglichkeiten zur Vorbereitung von Identitaetsdiebstahl mittels individueller Auswertung des beobachtbaren Netzwerkverkehrs. Ueber ein allfaelliges Wireless-Segment wuerde beispielsweise der Datenverkehr mit Mobiltelefonen zugaenglich, deren Datenabgleichsroutinen ueber die Netzstrecke als Informationsquelle erschliessbar.
<h3>Zeitdiebstahl und Anonymisierung</h3>
Dabei werden den Routern Pakete zur Abarbeitung uebermittelt, z.B. Attacken zur Uebernahme weiterer Router mit Brute-Force Password-Guessing. Die Ruecksendung von Ergebnissen an den Nutzniesser kann dadurch verschleiert werden, indem beispielsweise ein TOR-Service eingerichtet wird, an dessen anonymen Backend eine Webapplikation zur Aufnahme der Ergebnisse laeuft. Die Einrichtung von solchen Backends ist mit uebernommenen oder erfundenen Accounts moeglich, die verfuegbare Rechnerleistung mit typischen Entwickleraccounts bei Google-AppEngine oder Heroku beliebig skalierbar. Die Abholung der gesammelten Daten zur weiteren Verwertung kann ebenfalls vollstaendig anonymisiert mittels Webabfrage erfolgen. Bandbreiten- und Latenzfragen stehen im Hintergrund, da die Datenmengen nach entsprechender Vorverdichtung klein sind.
<h3>Proxy</h3>
Soferne auf dem Router Shellcode lauffaehig ist kann ein Tunnel etabliert werden, ueber welchen die Herkunft der Datenpakete verschleiert wird. Der Tunnel kann mit netcat oder connect etabliert werden, soferne ssh zur verfuegung steht kann die Datenverbindung verschluesselt erfolgen. Wird auf dem Zielrouter kein direkter Rueckkanal fuer eventuelle Resultate verwendet und anstatt dessen an einen eingerichteten Aggregator versandt, ist eine Entdeckung mit statistischen Mitteln unwahrscheinlich - der Datenverkehr ginge sowohl von seiner Charakteristik als auch Frequenz im herkoemmlichen Netzwerkverkehr unter.
<h3>Scanner-Proxy</h3>
Am Uebergang zwischen WAN und LAN kann bei offenen Routern die Einstellung der DMZ vorgenommen werden, beziehungsweise kann Port-Forwarding eingerichtet werden. Dadurch wird es moeglich, ein eingeschraenktes Scannen des LAN Segments von aussen durchzufuehren. Die meisten Router zeigen ein Liste der momentan angebundenen Endgeraete im LAN mit den entsprechenden Netzwerkadressen in ihrer Verwaltungsoberflaeche. Die Aufbringung von herkoemmlicher PC-Malware auf gefundene Systeme ist ebenfalls auf diesem Wege moeglich.
<h3>Verteilter Datenspeicher im Netz</h3>
Einzelne Routermodelle verfuegen ueber die Moeglichkeit, das telnet-service von der LAN-Seite zu oeffnen. Bei Vorhandensein der Firmware-Quelltexte waere eine unmerkliche Modifikation denkbar, die diese Moeglichkeit auch von der WAN-Seite anbietet. Dadurch wuerde sich die potentielle Nutzungsflaeche des Routers deutlich vergroessern, beispielsweise weil tftp von aussen fernsteuerbar nutzbar wuerde - der Router kann somit als temporaerer Datenspeicher eingesetzt werden.

Eine etwas umstaendlichere Variation mit demselben Ergebnis besteht natuerlich durch Einbau einer Befehlsoberflaeche in den routereigenen Webserver, welche allerdings nur dem Angreifer zugaenglich ist.

Fuer den Datenaustausch mit dem Router ist es ohne grossen programmiertechnischen Aufwand auch denkbar, einen trivialen Key-Value Store mit Zugang ueber den Webserver in die Firmware zu integrieren. Bei Sicherung der Daten im Nonvolatile Speicher des Routers wuerde der Datenbestand auch ueber Reboots hinweg verfuegbar.

Im Zusammenspiel mit anderen Routern erhielte man eine verteilte Datenbank - ein 'Feature', welches fuer allfaellige Zwecke eine bedeutende Komplexitaetsreduktion darstellte.

Da die meisten Router uber Moeglichkeiten zur Sicherung und Wiederherstellung der Konfigurationsdaten verfuegen, welche einen Abzug des Nonvolatile Speichers oft in binaerem Datenformat erstellen, kann auf diesem Wege auch eine Sicherung der Daten ueber ein effektives Update der Firmware hinweg angedacht werden. Ebenso eignet sich dieser Weg fuer das Einsammeln von Daten auf mehreren Routern ueber die unauffaellige Standardschnittstelle: ein Web-Request.
<h3>Mischformen mit bekannten Szenarien</h3>
Bei neueren Modellen koennen ueber USB Massenspeicher verfuegbar sein, welche die Kapazitaet des Routers erheblich vergroessern. Ein Exploit in diesem Bereich fuehrt allerdings in ein Feld hoeherer Sichtbarkeit, da diese Geraete oft als Server im Netzwerk integriert sind und von Endbenutzern wie ein Netzwerklaufwerk wahrnehmbar sind.

Zusaetzliche Moeglichkeiten ergeben sich in geographischer Naehe des Routers. Ist man im Sendebereich eines Access Points, so stellt die Mitnutzung kein Problem dar. Die herkoemmlichen Bedrohungsbilder fuer offene Wireless Router bestehen, ohne dass dies zwangslaeufig wahrnehmbar waere: so ist beispielsweise die Einrichtung einer Wireless-Bridge zu einem Internet-Cafe denkbar, mit welcher der gesamte Datenverkehr aus sicherer Position aufzeichenbar ist. Aufgeklaerte Benutzer kennen diese Bedrohung und sichern sich adequat. Ob diese Sorgfalt von der Mehrheit aber auch in einem Netzwerk geuebt wird, welches als gesichert gilt, ist anzuzweifeln.